{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///D:/cmder/quocbao-household-store/tg-dienmay/src/app/admin/danh-gia/page.jsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { db } from \"@/firebase/firebase\";\r\nimport { collection, getDocs, doc, deleteDoc, getDoc, updateDoc } from \"firebase/firestore\";\r\n\r\nexport default function Danhgia() {\r\n    const [allReviews, setAllReviews] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [filterStar, setFilterStar] = useState(-1);\r\n\r\n    useEffect(() => {\r\n        fetchAllReviews();\r\n    }, []);\r\n\r\n    async function fetchAllReviews() {\r\n        setLoading(true);\r\n        const productsCol = collection(db, \"products\");\r\n        const productsSnap = await getDocs(productsCol);\r\n        const reviewsArr = [];\r\n        for (const productDoc of productsSnap.docs) {\r\n            const productId = productDoc.id;\r\n            const reviewsCol = collection(db, \"products\", productId, \"reviews\");\r\n            const reviewsSnap = await getDocs(reviewsCol);\r\n            for (const reviewDoc of reviewsSnap.docs) {\r\n                const reviewData = reviewDoc.data();\r\n                let userName = reviewData.userName;\r\n                if (reviewData.userId && reviewData.userId !== \"Khách\" && reviewData.userId !== \"demoUser\") {\r\n                    const userRef = doc(db, \"users\", reviewData.userId);\r\n                    const userSnap = await getDoc(userRef);\r\n                    if (userSnap.exists()) {\r\n                        userName = userSnap.data().displayName || userName;\r\n                    }\r\n                }\r\n                reviewsArr.push({\r\n                    ...reviewData,\r\n                    productId,\r\n                    reviewId: reviewDoc.id,\r\n                    productName: productDoc.data().name,\r\n                    userName,\r\n                    hidden: reviewData.hidden ?? false,\r\n                    reported: reviewData.reported ?? false,\r\n                });\r\n            }\r\n        }\r\n        setAllReviews(reviewsArr);\r\n        setLoading(false);\r\n    }\r\n\r\n    const ratingLabels = [\"Chưa đánh giá\", \"Rất tệ\", \"Tệ\", \"Tạm ổn\", \"Tốt\", \"Rất tốt\"];\r\n    const filteredReviews = filterStar === -1\r\n        ? allReviews\r\n        : allReviews.filter(r => (r.rating ?? 0) === filterStar);\r\n\r\n    // Xoá đánh giá\r\n    const handleDelete = async (productId, reviewId) => {\r\n        if (window.confirm(\"Bạn có chắc muốn xoá đánh giá này?\")) {\r\n            await deleteDoc(doc(db, \"products\", productId, \"reviews\", reviewId));\r\n            fetchAllReviews();\r\n        }\r\n    };\r\n\r\n    // Ẩn/hiện đánh giá\r\n    const handleToggleHidden = async (productId, reviewId, current) => {\r\n        await updateDoc(doc(db, \"products\", productId, \"reviews\", reviewId), {\r\n            hidden: !current,\r\n        });\r\n        fetchAllReviews();\r\n    };\r\n\r\n    // Đánh dấu báo cáo bình luận xấu\r\n    const handleReport = async (productId, reviewId, current) => {\r\n        await updateDoc(doc(db, \"products\", productId, \"reviews\", reviewId), {\r\n            reported: !current,\r\n        });\r\n        fetchAllReviews();\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-8 min-h-screen bg-blue-900\">\r\n            <h1 className=\"text-2xl font-bold mb-6\">Quản lý đánh giá sản phẩm</h1>\r\n            <div className=\"mb-4 flex items-center gap-2\">\r\n                <span>Lọc theo số sao:</span>\r\n                <select\r\n                    className=\"border rounded px-2 py-1\"\r\n                    value={filterStar}\r\n                    onChange={e => setFilterStar(Number(e.target.value))}\r\n                >\r\n                    <option value={-1}>Tất cả</option>\r\n                    <option value={0}>0 sao - Chưa đánh giá</option>\r\n                    <option value={1}>1 sao - Rất tệ</option>\r\n                    <option value={2}>2 sao - Tệ</option>\r\n                    <option value={3}>3 sao - Tạm ổn</option>\r\n                    <option value={4}>4 sao - Tốt</option>\r\n                    <option value={5}>5 sao - Rất tốt</option>\r\n                </select>\r\n            </div>\r\n            {loading ? (\r\n                <div>Đang tải dữ liệu...</div>\r\n            ) : (\r\n                <div className=\"bg-blue-900 rounded-lg shadow p-6\">\r\n                    <table className=\"w-full text-sm border\">\r\n                        <thead>\r\n                            <tr className=\"bg-blue-900\">\r\n                                <th className=\"border px-2 py-2\">Sản phẩm</th>\r\n                                <th className=\"border px-2 py-2\">Người đánh giá</th>\r\n                                <th className=\"border px-2 py-2\">Số sao</th>\r\n                                <th className=\"border px-2 py-2\">Nội dung</th>\r\n                                <th className=\"border px-2 py-2\">Thời gian</th>\r\n                                <th className=\"border px-2 py-2\">Trạng thái</th>\r\n                                <th className=\"border px-2 py-2\">Thao tác</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {filteredReviews.length === 0 && (\r\n                                <tr>\r\n                                    <td colSpan={7} className=\"text-center py-4 text-gray-500\">Không có đánh giá phù hợp.</td>\r\n                                </tr>\r\n                            )}\r\n                            {filteredReviews.map((r, idx) => (\r\n                                <tr key={idx} className={r.hidden ? \"bg-gray-100 opacity-60\" : \"\"}>\r\n                                    <td className=\"border px-2 py-2\">{r.productName}</td>\r\n                                    <td className=\"border px-2 py-2\">{r.userName}</td>\r\n                                    <td className=\"border px-2 py-2\">\r\n                                        <div className=\"flex items-center gap-1\">\r\n                                            {[1,2,3,4,5].map(star => (\r\n                                                <svg key={star} width=\"16\" height=\"16\" viewBox=\"0 0 24 24\"\r\n                                                    fill={star <= (r.rating ?? 0) ? \"#FFA500\" : \"none\"}\r\n                                                    stroke=\"#FFA500\"\r\n                                                    strokeWidth=\"2\"\r\n                                                    strokeLinecap=\"round\"\r\n                                                    strokeLinejoin=\"round\"\r\n                                                >\r\n                                                    <polygon points=\"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2\"/>\r\n                                                </svg>\r\n                                            ))}\r\n                                            <span className=\"ml-2 text-xs\">{ratingLabels[r.rating ?? 0]}</span>\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"border px-2 py-2\">{r.text}</td>\r\n                                    <td className=\"border px-2 py-2\">{r.date}</td>\r\n                                    <td className=\"border px-2 py-2\">\r\n                                        {r.hidden ? (\r\n                                            <span className=\"text-red-500 font-semibold\">Đã ẩn</span>\r\n                                        ) : (\r\n                                            <span className=\"text-green-600 font-semibold\">Hiện</span>\r\n                                        )}\r\n                                        {r.reported && (\r\n                                            <div className=\"text-xs text-orange-600 font-semibold\">Bị báo cáo</div>\r\n                                        )}\r\n                                    </td>\r\n                                    <td className=\"border px-2 py-2 flex flex-col gap-1\">\r\n                                        <button\r\n                                            className={`px-2 py-1 rounded ${r.hidden ? \"bg-green-500\" : \"bg-gray-400\"} text-white`}\r\n                                            onClick={() => handleToggleHidden(r.productId, r.reviewId, r.hidden)}\r\n                                        >\r\n                                            {r.hidden ? \"Hiện\" : \"Ẩn\"}\r\n                                        </button>\r\n                                        <button\r\n                                            className={`px-2 py-1 rounded ${r.reported ? \"bg-orange-600\" : \"bg-orange-400\"} text-white`}\r\n                                            onClick={() => handleReport(r.productId, r.reviewId, r.reported)}\r\n                                        >\r\n                                            {r.reported ? \"Bỏ báo cáo\" : \"Báo xấu\"}\r\n                                        </button>\r\n                                        <button\r\n                                            className=\"px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600\"\r\n                                            onClick={() => handleDelete(r.productId, r.reviewId)}\r\n                                        >\r\n                                            Xoá\r\n                                        </button>\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}